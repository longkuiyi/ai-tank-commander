<div align="center">
<img width="1200" height="475" alt="AI Tank Commander Banner" src="https://github.com/user-attachments/assets/0aa67016-6eaf-458a-adb2-6e31a0763ed6" />

# AI Tank Commander: Tactical Arena
AI 驱动的实时坦克战术竞技场（Canvas + React + Ollama / Gemini）
</div>

---

## 概览
这是一个俯视角实时坦克对战原型：玩家可手动操控，也可以一键交给 AI 接管；盟友与敌方坦克都会根据“战术指令 + 局部 AI 行为”协同推进，在基地占领进度、地形减速与可破坏掩体的共同约束下完成战斗决策。

---

## 项目优点（详细版）

1. 队伍作战  
   游戏采用红蓝双方多坦克组队作战，而不是传统的“玩家 1V 多 AI”单机体验。  
   我方与敌方都会围绕据点、资源和基地占领进度进行协同移动、集火和防守，形成真正的“团队战场”。  
   玩家既是前线输出单位，也是全局指挥核心，可以通过战术指令影响整个小队的节奏和站位选择。

2. 障碍物多样化  
   地图中布置了水域、泥沼、泥土墙、反弹墙、玻璃墙等多种障碍类型，每种地形都会改变战斗节奏。  
   例如水域和泥沼会显著拖慢坦克与子弹的速度，而可破坏墙体可以用火力“开路”，反弹墙则鼓励利用角度打间接火力。  
   这些要素组合在一起，可以设计出“减速走廊”“反弹阴人位”“临时掩体”等有层次的战术方案。

3. 攻击坦克与破坏方块效果明显  
   命中敌方坦克会伴随清晰的受击反馈、血量变化与战场比分浮动，击杀后还会直接影响团队经济。  
   子弹打在可破坏方块上会出现显著的破碎与移除效果，让“开路”和“炸掩体”在视觉上都非常直观。  
   玩家可以很容易判断当前输出是否有效，从而快速调整站位、火力分配与目标优先级。

4. 操控灵活  
   在桌面端支持 WASD + 鼠标的经典操作方式，移动与炮塔方向完全解耦，手感接近传统射击游戏。  
   在移动端则提供虚拟摇杆与独立开火按钮，保证单手或双手操作时都能快速完成移动与射击。  
   再配合自动瞄准、自动射击和 AI 代打开关，玩家可以自由选择“手搓操作”还是“轻度半挂机”的游玩方式。

5. 物资多样  
   战场上会定期刷新各种增益物资，包括移速加成、防御加成、持续回血和伤害提升等。  
   不同 Buff 的持续时间和强度在常量中已经调好平衡，既能提供爽感又不会破坏战局节奏。  
   玩家需要在“捡资源”和“保阵地”之间做取舍，提前规划好哪些区域是资源争夺的高价值地带。

6. 商城系统  
   击杀敌方坦克会为全队带来金币收益，金币可以在“军需商城”中购买全队永久升级。  
   升级分为伤害、防御、速度、回血和急迫五大方向，每一点投入都会以数值形式实时反馈到战场表现上。  
   这让整局战斗拥有轻度的“团队养成”感觉，需要在前期就决定是走高机动、硬防守还是高爆发的战术路线。

7. 地形大小可调（可配置）  
   地图的宽高、单位尺寸和基础数值全部集中在常量文件中统一管理，支持按需调整整体战场尺度。  
   在当前版本中，开发者可以通过修改 `WORLD_WIDTH` / `WORLD_HEIGHT` 等参数快速改变地图大小与密度。  
   结合后续计划中的 UI 调整，将进一步向“通过滑杆实时预设地形大小”的可视化调节方式靠近。

8. 我方与敌方数量可调整  
   坦克数量并不是写死的，而是通过初始化配置决定战场上双方单位的规模。  
   这意味着可以很容易地切换成“小规模精英战”或“大规模混战”的不同体验，用来测试不同 AI 战术的稳定性。  
   对开发者来说，也方便根据设备性能和目标帧率来选择合适的参战数量。

9. 战场情报局排行榜  
   HUD 中内置了“战场情报局”面板，用于展示当前局内各单位的击杀、死亡和贡献情况。  
   玩家可以直观地看到自己与队友、敌方的输出差距，了解是哪一条战线撑住或崩盘。  
   这不仅提升了对局的可观测性，也为后续的历史战绩统计与复盘系统打下基础。

10. 游戏胜负显示清晰  
   双方基地都有独立的占领进度条与完整度指示，战斗过程中的形势变化一目了然。  
   当某一方基地被完全占领或战局结束时，游戏会给出醒目的胜负结算提示，并可一键重开新局。  
   这种“核心占点 + 进度反馈”的设计，避免了无目的的漫长对射，让每一局都有明确的目标和结束点。

11. 小地图与战场全局感知  
   屏幕一角提供简洁的小地图，实时显示友军、敌军以及重要地形分布。  
   玩家可以通过小地图判断哪条路线兵力薄弱、哪里正在爆发交火，从而做出更合理的移动和支援决策。  
   对于 AI 指挥官来说，小地图数据也是生成战术分析的重要输入之一。

12. 持续更新空间大  
   当前版本已经实现了基础战斗、地形、AI 行为和商城经济等核心系统。  
   代码结构上预留了多个扩展点，包括更多单位类型、新的战术指令、额外地形元素和模式切换。  
   这让整个项目非常适合二次开发或多人协作迭代，既可以当成游戏原型，也可以当成 AI 战术实验场。

---

## 创意更新与 AI 新玩法

1. 队友 AI 绕路规划  
   盟友坦克不会简单地“直线冲锋”，而是会根据障碍、基地位置和敌军分布选择更安全或更高效的路线。  
   在路径被可破坏墙体堵死时，AI 也会考虑通过火力开路来推进，而不是机械地原地打转。  
   这种“绕路 + 开路”的组合，让队友行为看起来更像一支有基本战术素养的小队，而不是普通的跟随 NPC。

2. AI 代打系统（重点）  
   玩家可以在系统设置中一键开启“AI 代打”，直接把自己坦克交给指挥官接管。  
   开启后，AI 会根据当前战况决定是推进、绕路、回防还是抢资源，并自动控制移动与射击。  
   你可以像观看职业选手打榜一样，在一旁观察它的决策过程，也可以随时关闭代打重新接管战局。

3. 自动自瞄（Auto-Aim）  
   自动瞄准会在一定范围内自动选取最近且威胁最大的敌方坦克作为目标，使炮塔快速对准。  
   当视线前方存在阻挡路线的可破坏墙体时，系统也会优先锁定掩体以帮你“打通道路”。  
   这一功能非常适合新手玩家，或者在你更专注于走位、绕后和躲技能时减轻操作负担。

4. 自动射击（Auto-Fire）  
   在自动射击模式下，当炮塔角度已经基本对准目标且命中概率较高时，系统会协助自动开火。  
   玩家不需要频繁点击，只需专注于走位、拉扯和资源点控制，就能保持稳定输出。  
   搭配自动瞄准和 AI 代打，可以形成“半自动 / 全自动”多种游玩强度，满足不同玩家的操作偏好。

5. 记忆系统（重点）  
   项目内置了战后记忆与学习模块，AI 指挥官会根据战局记录沉淀出“对某种打法有效/无效”的经验。  
   这些记忆会以“学到的战术”“玩家常用套路”“创新打法”等形式保存，并在后续对局中作为额外提示。  
   开启记忆后，你会感觉到指挥官越来越了解你的习惯，给出的建议也会逐步贴近你的风格。

6. 战术指令集  
   通过 HUD 菜单和快捷键，玩家可以快速下达“全军突击、占领据点、战术包围、核心防守、侦查模式、自由规划”等战术指令。  
   这些指令会同步到 AI 队友的行为逻辑中，影响他们的集火目标、推进路线和停留位置。  
   指令本身并不复杂，但配合 AI 自主判断和地形约束，可以组合出非常多样的战术打法。

7. AI 决策系统  
   顶层 AI 会定期获取全局战场快照，包含双方人数、基地血量、占领进度、资源点分布等信息。  
   然后调用大模型或规则引擎，对当前形势做出“进攻 / 防守 / 包围 / 侦查”等决策，并以战术分析文本形式展示。  
   随着记忆系统和更多特征的加入，这套决策系统可以逐步演化成可解释、可调参的“战术大脑”。

---

## 后续可能增加的内容

1. 玩家历史排行榜（历史战绩）  
   计划将当前局内的击杀、死亡、占点贡献等数据持久化保存，形成玩家个人的历史战绩档案。  
   通过“总击杀数”“MVP 次数”“最长连杀”等统计，让玩家能直观看到自己的成长曲线。  
   也可以在此基础上尝试多周目成就系统或段位制，增强长期可玩性。

2. AI 决策持续进化  
   目前的 AI 决策已经可以结合战况给出合理的进攻、防守和包围建议。  
   后续会考虑加入更多可观察指标，例如敌方常走路线、常用掩体位置和玩家常用打法标签。  
   在此基础上进一步丰富“针对性战术”，比如专门克制爱冲锋玩家或喜欢龟缩防守的 AI 策略。

3. 商城与经济系统优化  
   在现有“全队统一升级”的基础上，可以探索更细粒度的分支升级路径，例如偏重火力输出或偏重续航生存。  
   同时也会继续打磨金币获取节奏，让对局既不会因为经济过快而提早失衡，也不会因为经济过慢而缺乏成长感。  
   长期目标是做出一套既简单易懂又有深度选择空间的轻量级团队经济系统。

4. 视觉与技能效果优化  
   在保持性能稳定的前提下，逐步强化爆炸、命中、占点、回血等关键节点的特效表现。  
   通过颜色、光效和震动感的组合，让玩家在关键击杀或占点瞬间获得更强的反馈与成就感。  
   同时也会对低端设备做降级方案，确保在不同配置下都能获得流畅体验。

5. 场景与地图多样化  
   目前的地图更偏向“功能验证型”，后续会增加多套主题场景，比如城市废墟、雪地战场、沙漠要塞等。  
   不同场景会搭配不同的障碍布局与地形减速配置，鼓励玩家针对地图设计不同战术开局。  
   也会逐步尝试“多图轮换”或“随机生成部分地形”的机制，让每一局都带点新鲜感。

6. 更多模式选择  
   在基础占点模式之外，可以考虑扩展出防守生存、护送目标、资源争夺战等不同玩法。  
   不同模式会对 AI 行为、资源刷出和胜利条件做针对性调整，形成更加丰富的战术场景。  
   这也非常适合作为 AI 研究的实验场，用来测试不同算法在不同规则下的表现差异。

7. 音效与配乐强化  
   后续会逐步补全坦克发动机声、开火声、命中反馈、爆炸声等基础音效，并加入适当的环境音。  
   同时考虑加入随战况变化的动态配乐，让推进、僵持和反攻阶段的氛围更加鲜明。  
   声音层面会尽量保持克制不过度吵闹，在增强临场感的同时兼顾长时间游玩体验。

---

## 核心特性（优点一眼看懂）
- **AI 指挥官接入**：可通过 Ollama 调用大模型生成全局战术与队友无线电报告，并支持降级策略（规则引擎）。
- **双端控制**：桌面端 WASD 移动 + 鼠标炮塔指向 + 按住鼠标射击；移动端虚拟摇杆与开火按钮。
- **基地占领机制**：双方各有一个基地；进入占领范围推进进度，防守方可回退进度，进度达阈值即判定胜负。
- **环境与掩体**：水域/泥沼会降低坦克与子弹速度；反弹墙会让子弹产生反射；玻璃/泥墙等可被摧毁。
- **成长与经济**：击杀获得金币；军需商城可购买全队永久升级（伤害/防御/速度/回血/急迫）。
- **战斗辅助**：自瞄与自动射击可开关；支持 AI 代打接管玩家坦克。
- **性能优化**：墙体与坦克使用空间网格加速碰撞/命中检测；AI 逻辑分帧执行；渲染使用视口裁剪。

---

## 技术栈与实现要点
- **前端**：React + TypeScript + Vite
- **渲染**：HTML5 Canvas 2D（单画布世界坐标渲染，视口裁剪）
- **战斗与物理**：基础碰撞检测 + 子弹反射 + 坦克重叠推开（Push-out）+ 平滑绕路策略
- **AI**：
  - 首选：Ollama `/api/generate`（通过 Vite 代理解决浏览器跨域）
  - 可选：Gemini（需要 `VITE_GEMINI_API_KEY`）
  - 兜底：规则引擎（AI 离线时仍可运行）

---

## 玩法与战场系统

### 胜利条件
- 双方各拥有一个基地（我方 / 敌方），基地周围有明显的占领圈与装饰。
- 坦克进入敌方基地的占领半径会增加“占领进度”，离开则停止推进。
- 防守方若在圈内，则会快速压制并回退对方的占领进度。
- 某一方基地占领进度达到阈值后，本局结束并判定胜负。

### 单位类型
- 玩家坦克
  - 支持键鼠或移动端虚拟摇杆操作。
  - 可在系统设置中开启“AI 代打”“自动瞄准”“自动射击”。
- 盟友坦克
  - 会根据当前战术指令（进攻 / 占点 / 包围 / 侦查 / 防守）自动行动。
  - 在 HUD 左侧“战术指挥链路”中会以对话形式汇报战况。
- 敌方坦克
  - 拥有自己的指挥官逻辑，会对玩家与我方基地做出针对性行动。

### 地形与障碍物
- 水域（WATER）
  - 坦克经过会显著减速。
  - 子弹穿过时会被减速，形成“水中减速线”效果。
- 泥沼与泥土墙（SWAMP / MUD）
  - 泥沼区域会强烈限制移动速度，适合作为天然减速陷阱。
  - 泥土墙可被子弹摧毁，用火力“开路”。
- 反弹墙（REBOUND）
  - 子弹命中后会根据碰撞方向反射。
  - 适用于打角度和间接火力。
- 玻璃墙（GLASS）
  - 半透明视效，能被迅速破坏，适合设计“临时掩体”玩法。

### 物资与增益
- 地图上会定期刷出随机物资：
  - 速度加成：短时间内获得高额移速增益。
  - 防御加成：显著减免受到的伤害。
  - 持续回血：在一定时间内持续恢复生命。
  - 伤害加成：提高单发伤害输出。
- 我方坦克在己方基地附近会获得额外缓慢回血。

### 军需商城（SHOP）
- 通过击败敌方坦克获取金币。
- 在 HUD 菜单中选择“军需商城”，可为全队购买永久提升：
  - 伤害（damage）
  - 防御（defense）
  - 移动速度（speed）
  - 自动回血效率（regen）
  - 射速与子弹速度（haste）

---

## 操作与快捷键
- **移动（桌面端）**：W / A / S / D
- **瞄准**：鼠标指向决定炮塔方向
- **开火**：按住鼠标左键（移动端为开火按钮）
- **菜单 Tab（打开/切换）**：J（军需商城）/ P（战场情报局）/ Z（系统设置）/ L 或 E（战术指令集）

---

## AI 行为与开关

### 顶层指挥系统
- AI 指挥官会周期性获取战场快照，并调用大模型生成：
  - 全局形势分析（`globalAnalysis`）
  - 当前主战术指令（`command`）
  - 各坦克无线电汇报（`teammateReports`：包含坦克 ID、文本汇报、建议策略）
- 这些信息会：
  - 映射为游戏内战术指令（进攻 / 占点 / 包围 / 防守 / 侦查 / 自由规划）。
  - 在 HUD 中以“战术分析”“队友聊天”形式展示给玩家。

### AI 代打（Autopilot）
- 可在“系统设置”菜单中切换 AI 代打开关。
- 开启后：
  - 玩家坦克移动速度获得额外倍率加成（见 `AI_AUTOPILOT_SPEED_MULT`）。
  - 顶层指挥逻辑会直接控制玩家坦克的行动与对话。
  - 菜单会短暂自动弹出，模拟“AI 下达指令”的过程。

### 自动瞄准与自动射击
- 自动瞄准：
  - 自动搜索一定范围内最近的敌方坦克，并将炮塔对准目标。
  - 若前方有堵路的可破坏墙体，也会优先锁定以开路。
- 自动射击：
  - 在瞄准角度足够接近目标时自动开火。
  - 支持桌面端与移动端。

---

## 快速启动

```bash
git clone <repo-url>
cd ai-tank-commander-tactical-arena
npm install
```

### 可选：启用 Ollama 大模型
- 安装并启动 Ollama（默认监听 `http://localhost:11434`）
- 拉取任意可用模型（示例）：

```bash
ollama pull gpt-oss:120b-cloud
```

项目会通过 Vite 代理访问 Ollama：
- 浏览器请求：`/api-ollama/api/tags`、`/api-ollama/api/generate`
- 实际转发：`http://localhost:11434/api/tags`、`http://localhost:11434/api/generate`

### 运行
```bash
npm run dev
```
打开 `http://localhost:3000`。

## 配置入口
- AI 模型与超时：`AI_CONFIG` in [constants.ts](file:///Users/diqunfang/Desktop/tankGemini/ai-tank-commander-tactical-arena/constants.ts#L86-L92)
- 代理设置：Vite `server.proxy` in [vite.config.ts](file:///Users/diqunfang/Desktop/tankGemini/ai-tank-commander-tactical-arena/vite.config.ts#L8-L27)
- Gemini Key（可选）：设置环境变量 `VITE_GEMINI_API_KEY`

---

## 开发者指南（文件结构与可调参数）

### 关键文件
- 游戏主循环与渲染：
  - [GameCanvas.tsx](file:///Users/diqunfang/Desktop/tankGemini/ai-tank-commander-tactical-arena/components/GameCanvas.tsx)
- HUD、菜单与军需商城：
  - [HUD.tsx](file:///Users/diqunfang/Desktop/tankGemini/ai-tank-commander-tactical-arena/components/HUD.tsx)
- AI 指挥官与大模型调用：
  - [geminiService.ts](file:///Users/diqunfang/Desktop/tankGemini/ai-tank-commander-tactical-arena/services/geminiService.ts)
- AI 记忆系统与战后学习：
  - [memoryService.ts](file:///Users/diqunfang/Desktop/tankGemini/ai-tank-commander-tactical-arena/services/memoryService.ts)
- 全局常量与数值平衡：
  - [constants.ts](file:///Users/diqunfang/Desktop/tankGemini/ai-tank-commander-tactical-arena/constants.ts)
- 类型定义与基础枚举：
  - [types.ts](file:///Users/diqunfang/Desktop/tankGemini/ai-tank-commander-tactical-arena/types.ts)

### 常见可调参数
- 地图大小、单位尺寸等：
  - `WORLD_WIDTH` / `WORLD_HEIGHT`
  - `TANK_SIZE` / `BULLET_SIZE` / `WALL_SIZE` / `BED_SIZE`
- 速度与数值：
  - `PLAYER_SPEED` / `AI_SPEED` / `AI_AUTOPILOT_SPEED_MULT`
  - `BULLET_SPEED` / `BULLET_DAMAGE`
  - 各类 Buff 时长与系数（`ITEM_BUFF_VALUES` 等）
- 地形减速与子弹减速：
  - `WATER_SLOW_FACTOR` / `SWAMP_SLOW_FACTOR`
  - `BULLET_WATER_SLOW_FACTOR` / `BULLET_SWAMP_SLOW_FACTOR`
- 基地相关：
  - `CAPTURE_TIME_REQUIRED`（占领所需进度）
  - `CAPTURE_RADIUS`（占领半径）

### AI 相关配置
- 优先使用的模型与请求超时：
  - `AI_CONFIG.OLLAMA_MODEL`
  - `AI_CONFIG.REQUEST_TIMEOUT`
- 是否优先尝试 Ollama：
  - `AI_CONFIG.USE_OLLAMA_FIRST`

---

## 贡献
- 欢迎提交 PR：AI 策略、性能优化、地图/障碍物玩法、UI 与交互都很适合扩展。
